# media_picker

Unified media management for Flutter. Pick images, videos, and documents from camera, gallery, or files with a single API.

## Installation

Add to your `pubspec.yaml`:

```yaml
dependencies:
  media_picker: ^1.0.0
```


### Platform Setup

**iOS** - Add to `ios/Runner/Info.plist`:
```xml
<!-- Camera permissions -->
<key>NSCameraUsageDescription</key>
<string>This app needs camera access to take photos and videos</string>

<key>NSMicrophoneUsageDescription</key>
<string>This app needs microphone access to record videos</string>

<!-- Gallery/Photo Library permissions -->
<key>NSPhotoLibraryUsageDescription</key>
<string>This app needs photo library access to select media</string>

<key>NSPhotoLibraryAddUsageDescription</key>
<string>This app needs permission to save photos to your library</string>

<!-- iOS 14+: Prevent automatic "Limited Access" alert (optional) -->
<key>PHPhotoLibraryPreventAutomaticLimitedAccessAlert</key>
<true/>

<!-- File picker support -->
<key>UISupportsDocumentBrowser</key>
<true/>

<key>LSSupportsOpeningDocumentsInPlace</key>
<true/>

<!-- Orientation support for iPhone -->
<key>UISupportedInterfaceOrientations</key>
<array>
    <string>UIInterfaceOrientationPortrait</string>
    <string>UIInterfaceOrientationLandscapeLeft</string>
    <string>UIInterfaceOrientationLandscapeRight</string>
</array>

<!-- REQUIRED: Orientation support for iPad (tablet camera) -->
<key>UISupportedInterfaceOrientations~ipad</key>
<array>
    <string>UIInterfaceOrientationPortrait</string>
    <string>UIInterfaceOrientationPortraitUpsideDown</string>
    <string>UIInterfaceOrientationLandscapeLeft</string>
    <string>UIInterfaceOrientationLandscapeRight</string>
</array>
```

**iOS Podfile** - Add for permission_handler:
```ruby
post_install do |installer|
  installer.pods_project.targets.each do |target|
    flutter_additional_ios_build_settings(target)
    target.build_configurations.each do |config|
      config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= [
        '$(inherited)',
        'PERMISSION_CAMERA=1',
        'PERMISSION_PHOTOS=1',
        'PERMISSION_MEDIA_LIBRARY=1',
      ]
    end
  end
end
```

**iOS Notes**:
- iOS 14+ users can grant "Limited Photo Access" - package handles this gracefully
- HEIC images must be tested on real devices (not simulator)

**Android** - Add to `android/app/src/main/AndroidManifest.xml`:
```xml
<!-- Camera permissions -->
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.RECORD_AUDIO" />

<!-- Gallery/Storage - Android 13+ (API 33) -->
<uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
<uses-permission android:name="android.permission.READ_MEDIA_VIDEO" />
<uses-permission android:name="android.permission.READ_MEDIA_AUDIO" />

<!-- Legacy storage - Android 12 and below only -->
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"
    android:maxSdkVersion="32" />

<!-- Optional: Access media location (EXIF data) -->
<uses-permission android:name="android.permission.ACCESS_MEDIA_LOCATION" />

<!-- Camera feature -->
<uses-feature android:name="android.hardware.camera" android:required="false" />
<uses-feature android:name="android.hardware.camera.autofocus" android:required="false" />
```

For tablet/landscape support, update your `MainActivity`:
```xml
<activity
    android:name=".MainActivity"
    android:screenOrientation="sensor"
    android:configChanges="orientation|screenSize|keyboardHidden">
</activity>
```

**Android Notes**:
- `WRITE_EXTERNAL_STORAGE` is **no longer needed** on Android 11+ (API 30)
- Use `maxSdkVersion="32"` for `READ_EXTERNAL_STORAGE` (Android 12 and below only)
- Android 13+ uses granular `READ_MEDIA_*` permissions instead of storage permissions
- On Android 16+ (API 36) with width >= 600dp, orientation lock may not work

**Web** - File picker only (camera not supported on web)

## Getting Started

```dart
import 'package:flutter/material.dart';

void main() {
  runApp(const MyApp());  // No ProviderScope needed!
}
```

## Quick Reference

### Pick Images from Gallery
```dart
final result = await MediaPicker.pickFromGallery(maxImages: 5);
```

### Pick Videos from Gallery
```dart
final result = await MediaPicker.pickVideosFromGallery(maxVideos: 3);
```

### Pick Files (Web)
```dart
final result = await MediaPicker.pickFiles(allowedExtensions: ['jpg', 'png', 'pdf']);
```

### Capture Images with Camera
```dart
final result = await MediaPicker.captureFromCamera(context);
```

### Capture Videos with Camera
```dart
final result = await MediaPicker.captureVideosFromCamera(context);
```

## Pick Images from Gallery

Use `MediaPicker.pickFromGallery()` to select images from the device gallery:

```dart
import 'package:media_picker/media_picker.dart';

Future<void> pickImagesFromGallery() async {
  final result = await MediaPicker.pickFromGallery(
    maxImages: 10,
    compressionOptions: CompressionOptions(quality: 90),
  );

  result.fold(
    (failure) {
      // Handle error - see Error Handling section
      print('Error: $failure');
    },
    (images) {
      // Success - process images
      print('Selected ${images.length} images');
      for (final image in images) {
        // Images are automatically compressed
        // image.data is Uint8List - ready for upload or display
        // image.path is file path
        print('Image: ${image.id}, Size: ${image.data.length} bytes');
      }
    },
  );
}
```

### In a Widget

```dart
class GalleryPickerWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return ElevatedButton(
      onPressed: () async {
        final result = await MediaPicker.pickFromGallery(maxImages: 5);

        result.fold(
          (failure) => ScaffoldMessenger.of(context).showSnackBar(
            SnackBar(content: Text('Error: $failure')),
          ),
          (images) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text('Selected ${images.length} images')),
            );
          },
        );
      },
      child: Text('Pick from Gallery'),
    );
  }
}
```

## Pick Videos from Gallery

Use `MediaPicker.pickVideosFromGallery()` to select videos:

```dart
import 'package:media_picker/media_picker.dart';

Future<void> pickVideos() async {
  final result = await MediaPicker.pickVideosFromGallery(maxVideos: 5);

  result.fold(
    (failure) => print('Error: $failure'),
    (videos) {
      for (final video in videos) {
        // video.path - file path (videos are NOT compressed)
        // video.durationMs - duration in milliseconds
        // video.thumbnailPath - optional thumbnail path
        print('Video: ${video.path}, Duration: ${video.durationMs}ms');
      }
    },
  );
}
```

## Pick Files (Web Compatible)

Use `MediaPicker.pickFiles()` for web platforms or file system selection:

```dart
import 'package:flutter/foundation.dart';
import 'package:media_picker/media_picker.dart';

Future<void> pickFiles() async {
  final result = await MediaPicker.pickFiles(
    allowedExtensions: ['jpg', 'png', 'pdf'],  // Customize allowed types
  );

  result.fold(
    (failure) => print('Error: $failure'),
    (files) {
      print('Picked ${files.length} files');
      for (final file in files) {
        print('File: ${file.fileName}, Extension: ${file.extension}');
      }
    },
  );
}
```

## Capture Images from Camera

Use `MediaPicker.captureFromCamera()` to capture images with optional metadata:

```dart
import 'package:media_picker/media_picker.dart';

Future<void> captureImages(BuildContext context) async {
  final result = await MediaPicker.captureFromCamera(
    context,
    options: CameraViewOptions(
      showMetadataOverlay: true,
      imageMetadataList: [
        ImageMetadataEntity(
          title: 'Front View',
          description: 'Front side of vehicle',
        ),
        ImageMetadataEntity(
          title: 'Back View',
          description: 'Rear side of vehicle',
        ),
      ],
    ),
    compressionOptions: CompressionOptions(quality: 85),
  );

  result.fold(
    (failure) => print('Error: $failure'),
    (images) {
      for (final image in images) {
        // image.data is Uint8List - ready for upload or display
        // image.path is file path
        // image.metadata contains selected metadata
        print('Captured: ${image.id}, Size: ${image.data.length} bytes');
      }
    },
  );
}
```

## Capture Videos from Camera

Use `MediaPicker.captureVideosFromCamera()` for video capture:

```dart
import 'package:media_picker/media_picker.dart';

Future<void> captureVideos(BuildContext context) async {
  final result = await MediaPicker.captureVideosFromCamera(
    context,
    options: CameraViewOptions(
      initialCaptureMode: CaptureMode.video,
      showModeToggle: true,  // Allow switching between photo/video
      videoMetadataList: [
        VideoMetadataEntity(
          title: 'Interview Recording',
          description: 'Candidate interview session',
        ),
      ],
    ),
  );

  result.fold(
    (failure) => print('Error: $failure'),
    (videos) {
      for (final video in videos) {
        // video.path - file path (videos are path-based for memory efficiency)
        // video.durationMs - duration in milliseconds
        print('Video: ${video.id}, Duration: ${video.durationMs}ms');
      }
    },
  );
}
```

## Compression Options

### Global Compression Defaults

Set app-wide compression defaults:

```dart
import 'package:media_picker/media_picker.dart';

void main() {
  // Set global compression defaults for all MediaPicker operations
  MediaPicker.defaultCompressionOptions = CompressionOptions(
    quality: 90,              // 0-100 (default: 80)
    minWidth: 2048,           // default: 800
    minHeight: 1536,          // default: 600
    format: CompressFormat.jpeg,  // or CompressFormat.png
    keepExif: false,          // Strip EXIF data (default: false)
  );

  runApp(const MyApp());
}
```

### Per-Operation Compression

Override compression for specific operations:

```dart
// High quality for important images
final highQualityResult = await MediaPicker.pickFromGallery(
  maxImages: 5,
  compressionOptions: CompressionOptions(
    quality: 95,
    minWidth: 3840,
    minHeight: 2160,
  ),
);

// Lower quality for thumbnails
final thumbnailResult = await MediaPicker.pickFromGallery(
  maxImages: 10,
  compressionOptions: CompressionOptions(
    quality: 70,
    minWidth: 800,
    minHeight: 600,
  ),
);

// Camera with custom compression
final cameraResult = await MediaPicker.captureFromCamera(
  context,
  compressionOptions: CompressionOptions(quality: 90),
);
```

**Note:** Compression only applies to images picked from gallery and captured from camera. Videos are NOT compressed to avoid format conversion issues.

## Image Metadata

Add metadata options that users can select during capture:

```dart
import 'package:media_picker/media_picker.dart';

final result = await MediaPicker.captureFromCamera(
  context,
  options: CameraViewOptions(
    showMetadataOverlay: true,  // Show metadata selection UI
    imageMetadataList: [
      ImageMetadataEntity(
        title: 'ID Card Front',
        description: 'Front side of identification card',
        customData: {'type': 'id_card', 'side': 'front'},
      ),
      ImageMetadataEntity(
        title: 'ID Card Back',
        description: 'Back side of identification card',
        customData: {'type': 'id_card', 'side': 'back'},
      ),
      ImageMetadataEntity(
        title: 'Passport',
        description: 'Passport information page',
        customData: {'type': 'passport'},
      ),
    ],
  ),
  compressionOptions: CompressionOptions(quality: 85),
);
```

User selects metadata during capture. Access via `image.metadata`:

```dart
if (image.metadata != null) {
  print('Title: ${image.metadata!.title}');
  print('Description: ${image.metadata!.description}');
  print('Custom data: ${image.metadata!.customData}');
}
```

## Video Metadata

Add metadata options for video captures:

```dart
import 'package:media_picker/media_picker.dart';

final result = await MediaPicker.captureVideosFromCamera(
  context,
  options: CameraViewOptions(
    initialCaptureMode: CaptureMode.video,
    showMetadataOverlay: true,
    videoMetadataList: [
      VideoMetadataEntity(
        title: 'Interview Recording',
        description: 'Candidate interview session',
        customData: {'session': 'interview_1', 'candidate_id': '12345'},
      ),
      VideoMetadataEntity(
        title: 'Product Demo',
        description: 'Product demonstration video',
        customData: {'product_id': 'prod_001'},
      ),
    ],
  ),
);
```

Access video metadata:

```dart
if (video.metadata != null) {
  print('Title: ${video.metadata!.title}');
  print('Session: ${video.metadata!.customData?['session']}');
}
```

## Error Handling

All operations return `Either<MediaFailure, T>`. Handle all failure cases with pattern matching:

```dart
import 'package:dartz/dartz.dart';
import 'package:media_picker/media_picker.dart';

void handleResult(Either<MediaFailure, List<ImageEntity>> result) {
  result.fold(
    (failure) {
      // Pattern match ALL failure cases
      failure.when(
        permissionDenied: () {
          // Show permission dialog, link to settings
          showDialog(
            context: context,
            builder: (context) => AlertDialog(
              title: Text('Permission Required'),
              content: Text('Please grant camera/photos permission in settings'),
              actions: [
                TextButton(
                  onPressed: () {
                    // Open app settings
                  },
                  child: Text('Open Settings'),
                ),
              ],
            ),
          );
        },
        cameraError: (message) {
          // Camera unavailable or failed
          print('Camera error: $message');
          showSnackBar('Camera error: $message');
        },
        galleryError: (message) {
          // Gallery picker failed
          print('Gallery error: $message');
          showSnackBar('Failed to access gallery: $message');
        },
        filePickerError: (message) {
          // File picker failed
          print('File picker error: $message');
        },
        compressionFailed: (message) {
          // Image compression failed
          print('Compression error: $message');
        },
        noCameraAvailable: () {
          // Device has no camera
          showSnackBar('This device does not have a camera');
        },
        videoRecordingFailed: (message) {
          // Video capture failed
          print('Video error: $message');
        },
        cancelled: () {
          // User cancelled - usually not an error
          print('User cancelled');
        },
        unknown: (message) {
          // Unexpected error
          print('Unknown error: $message');
          showSnackBar('An error occurred: $message');
        },
      );
    },
    (images) {
      // Success case
      print('Success! Got ${images.length} images');
    },
  );
}
```

### Helper: Simplified Error Handler

```dart
void showErrorMessage(BuildContext context, MediaFailure failure) {
  final message = failure.when(
    permissionDenied: () => 'Permission denied. Please enable in settings.',
    cameraError: (msg) => 'Camera error: $msg',
    galleryError: (msg) => 'Gallery error: $msg',
    filePickerError: (msg) => 'File picker error: $msg',
    compressionFailed: (msg) => 'Compression failed: $msg',
    noCameraAvailable: () => 'No camera available on this device',
    videoRecordingFailed: (msg) => 'Video recording failed: $msg',
    cancelled: () => 'Operation cancelled',
    unknown: (msg) => 'Unknown error: $msg',
  );

  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text(message)),
  );
}

// Usage
result.fold(
  (failure) => showErrorMessage(context, failure),
  (images) => processImages(images),
);
```

## Entities

### ImageEntity

```dart
class ImageEntity {
  final String id;              // Unique identifier
  final Uint8List data;         // Image bytes in memory
  final String extension;       // e.g., 'jpg', 'png'
  final String path;            // File path
  final String? fileName;       // Original file name
  final ImageMetadataEntity? metadata;  // Optional metadata
}
```

Example:
```dart
print('Image ID: ${image.id}');
print('Size: ${image.data.length} bytes');
print('Extension: ${image.extension}');
print('Path: ${image.path}');
if (image.metadata != null) {
  print('Title: ${image.metadata!.title}');
}
```

### VideoEntity

```dart
class VideoEntity {
  final String id;              // Unique identifier
  final String path;            // File path (videos NOT loaded in memory)
  final String extension;       // e.g., 'mp4', 'mov'
  final String fileName;        // File name
  final int? durationMs;        // Duration in milliseconds
  final int? width;             // Video width in pixels
  final int? height;            // Video height in pixels
  final String? thumbnailPath;  // Optional thumbnail path
  final VideoMetadataEntity? metadata;  // Optional metadata
}
```

Example:
```dart
print('Video ID: ${video.id}');
print('Path: ${video.path}');
print('Duration: ${video.durationMs}ms');
print('Resolution: ${video.width}x${video.height}');
if (video.metadata != null) {
  print('Title: ${video.metadata!.title}');
}
```

### ImageMetadataEntity

```dart
class ImageMetadataEntity {
  final String? title;
  final String? description;
  final DateTime? capturedAt;
  final Map<String, dynamic>? customData;
  final String? overlayImagePath;  // Path to overlay image
  final String? overlayImageUrl;   // URL to overlay image
}
```

### VideoMetadataEntity

```dart
class VideoMetadataEntity {
  final String? title;
  final String? description;
  final DateTime? capturedAt;
  final Map<String, dynamic>? customData;
  final String? overlayImagePath;
  final double? frameRate;
}
```

## Camera View Options

### CameraViewOptions

```dart
class CameraViewOptions {
  final CaptureMode initialCaptureMode;    // photo, video, or both
  final bool showModeToggle;               // Show photo/video toggle
  final bool showMetadataOverlay;          // Show metadata selection
  final List<ImageMetadataEntity> imageMetadataList;
  final List<VideoMetadataEntity> videoMetadataList;
}
```

Example configurations:

```dart
// Photo only
CameraView(
  options: CameraViewOptions(
    initialCaptureMode: CaptureMode.photo,
    showModeToggle: false,
  ),
)

// Video only
CameraView(
  options: CameraViewOptions(
    initialCaptureMode: CaptureMode.video,
    showModeToggle: false,
  ),
)

// Photo and video with toggle
CameraView(
  options: CameraViewOptions(
    initialCaptureMode: CaptureMode.photo,
    showModeToggle: true,  // User can switch to video
  ),
)

// With metadata
CameraView(
  options: CameraViewOptions(
    showMetadataOverlay: true,
    imageMetadataList: [
      ImageMetadataEntity(title: 'Option 1'),
      ImageMetadataEntity(title: 'Option 2'),
    ],
  ),
)
```

## Compression Options

### CompressionOptions

```dart
class CompressionOptions {
  final int quality;              // 0-100 (default: 80)
  final int minWidth;             // default: 800
  final int minHeight;            // default: 600
  final int rotate;               // Rotation in degrees (default: 0)
  final int inSampleSize;         // default: 1
  final bool autoCorrectionAngle; // default: true
  final CompressFormat format;    // jpeg or png (default: jpeg)
  final bool keepExif;            // default: false
}
```

Example:

```dart
CompressionOptions(
  quality: 90,                        // High quality
  minWidth: 1920,                     // Full HD width
  minHeight: 1080,                    // Full HD height
  format: CompressFormat.jpeg,        // JPEG format
  keepExif: false,                    // Strip EXIF data for privacy
  autoCorrectionAngle: true,          // Auto-rotate based on EXIF
)
```

## Advanced Usage

### Direct Use Case Instantiation

For advanced users who want direct control, you can instantiate use cases manually:

```dart
import 'package:media_picker/media_picker.dart';

// Create dependencies manually
final galleryDataSource = GalleryDataSourceImpl();
final compressionDataSource = CompressionDataSourceImpl(
  CompressionOptions(quality: 90),
);
final permissionDataSource = PermissionDataSourceImpl();
final imageMapper = ImageMapper();
final videoMapper = VideoMapper();
final cameraDataSource = CameraDataSourceImpl();
final filePickerDataSource = FilePickerDataSourceImpl();

// Create repositories
final mediaRepository = MediaRepositoryImpl(
  cameraDataSource: cameraDataSource,
  galleryDataSource: galleryDataSource,
  filePickerDataSource: filePickerDataSource,
  compressionDataSource: compressionDataSource,
  imageMapper: imageMapper,
  videoMapper: videoMapper,
);

final permissionRepository = PermissionRepositoryImpl(
  permissionDataSource: permissionDataSource,
);

// Create use case
final usecase = PickGalleryImagesUsecase(
  mediaRepository,
  permissionRepository,
);

// Execute
final result = await usecase.execute(maxImages: 5);
```

**Note:** Most users should use `MediaPicker` static methods instead of manual DI.

## Best Practices

### 1. Handle All Error Cases

Always handle all `MediaFailure` cases with `.when()`:

```dart
result.fold(
  (failure) {
    failure.when(
      permissionDenied: () { /* handle */ },
      cameraError: (msg) { /* handle */ },
      galleryError: (msg) { /* handle */ },
      filePickerError: (msg) { /* handle */ },
      compressionFailed: (msg) { /* handle */ },
      noCameraAvailable: () { /* handle */ },
      videoRecordingFailed: (msg) { /* handle */ },
      cancelled: () { /* handle */ },
      unknown: (msg) { /* handle */ },
    );
  },
  (data) { /* success */ },
);
```

### 2. Set Appropriate Compression

Different use cases require different compression levels:

```dart
// Profile pictures - high quality
final profile = await MediaPicker.pickFromGallery(
  maxImages: 1,
  compressionOptions: CompressionOptions(quality: 95),
);

// Thumbnails - lower quality
final thumbnails = await MediaPicker.pickFromGallery(
  maxImages: 10,
  compressionOptions: CompressionOptions(quality: 70, minWidth: 400),
);
```

### 3. Videos Are Path-Based

Videos use file paths, not in-memory data:

```dart
// CORRECT
final videoPath = video.path;
final file = File(videoPath);

// WRONG - videos don't have data property
// final bytes = video.data;  // This doesn't exist!
```

### 4. Check Null for Optional Fields

```dart
if (image.metadata != null) {
  print('Title: ${image.metadata!.title}');
}

if (video.durationMs != null) {
  print('Duration: ${video.durationMs! / 1000} seconds');
}
```

### 5. Dispose of Data Properly

Images are loaded in memory, so dispose properly:

```dart
// If using Image.memory
Image.memory(imageEntity.data)

// Clear references when done
imageList.clear();
```

## Example: Complete Image Upload Flow

```dart
import 'package:http/http.dart' as http;
import 'package:media_picker/media_picker.dart';

Future<void> uploadImages() async {
  // 1. Pick images with compression
  final result = await MediaPicker.pickFromGallery(
    maxImages: 5,
    compressionOptions: CompressionOptions(quality: 85),
  );

  // 2. Handle errors
  await result.fold(
    (failure) async {
      failure.when(
        permissionDenied: () => showPermissionDialog(),
        cancelled: () => print('User cancelled'),
        galleryError: (msg) => showError(msg),
        compressionFailed: (msg) => showError(msg),
        filePickerError: (msg) => showError(msg),
        cameraError: (msg) => showError(msg),
        noCameraAvailable: () => showError('No camera'),
        videoRecordingFailed: (msg) => showError(msg),
        unknown: (msg) => showError(msg),
      );
    },
    (images) async {
      // 3. Upload each image
      for (final image in images) {
        final request = http.MultipartRequest(
          'POST',
          Uri.parse('https://api.example.com/upload'),
        );

        request.files.add(
          http.MultipartFile.fromBytes(
            'image',
            image.data,
            filename: image.fileName ?? 'image.${image.extension}',
          ),
        );

        // Add metadata if present
        if (image.metadata != null) {
          request.fields['title'] = image.metadata!.title ?? '';
          request.fields['description'] = image.metadata!.description ?? '';
        }

        final response = await request.send();
        if (response.statusCode == 200) {
          print('Uploaded: ${image.id}');
        }
      }
    },
  );
}
```

## Example: Complete Video Capture Flow

```dart
import 'dart:io';
import 'package:media_picker/media_picker.dart';

Future<void> captureAndProcessVideo(BuildContext context) async {
  // 1. Capture videos
  final result = await MediaPicker.captureVideosFromCamera(
    context,
    options: CameraViewOptions(
      initialCaptureMode: CaptureMode.video,
      showModeToggle: false,
      videoMetadataList: [
        VideoMetadataEntity(
          title: 'Interview',
          description: 'Job interview recording',
        ),
      ],
    ),
  );

  // 2. Process result
  await result.fold(
    (failure) async {
      print('Error: $failure');
    },
    (videos) async {
      if (videos.isEmpty) {
        print('No videos captured');
        return;
      }

      // 3. Process videos
      for (final video in videos) {
        final file = File(video.path);
        final fileSize = await file.length();

        print('Video captured:');
        print('  Path: ${video.path}');
        print('  Duration: ${video.durationMs}ms');
        print('  Size: ${fileSize / 1024 / 1024} MB');

        if (video.metadata != null) {
          print('  Title: ${video.metadata!.title}');
        }

        // Upload or process the video file
        // await uploadVideo(file);
      }
    },
  );
}
```

## Testing

The package is well-tested with 80%+ code coverage. For your own tests:

```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/mockito.dart';
import 'package:media_picker/media_picker.dart';

void main() {
  group('MediaPicker', () {
    test('pickFromGallery returns images', () async {
      final result = await MediaPicker.pickFromGallery(maxImages: 5);

      result.fold(
        (failure) => fail('Should not fail'),
        (images) {
          expect(images, isA<List<ImageEntity>>());
        },
      );
    });
  });
}
```

## Troubleshooting

### Permission Issues

**iOS**: Check `Info.plist` has camera/photo usage descriptions
**Android**: Check `AndroidManifest.xml` has permission declarations

### Camera Not Working

1. Check device has camera: `CameraDataSourceImpl().isCameraAvailable()`
2. Check permissions are granted
3. Check platform support (web doesn't support camera)

### Compression Fails

1. Check image format is supported (jpg, png)
2. Check image data is valid
3. Try reducing quality or resolution

### Large Memory Usage

Videos are path-based (not loaded in memory), but images are. Limit `maxImages` if memory is a concern:

```dart
final result = await MediaPicker.pickFromGallery(
  maxImages: 3,  // Limit to prevent OOM
  compressionOptions: CompressionOptions(
    quality: 70,  // Lower quality = less memory
  ),
);
```

## Migration from Other Packages

### From image_picker

```dart
// OLD: image_picker
final ImagePicker picker = ImagePicker();
final XFile? image = await picker.pickImage(source: ImageSource.gallery);

// NEW: this package
final result = await MediaPicker.pickFromGallery(maxImages: 1);
result.fold(
  (failure) => print('Error'),
  (images) {
    final image = images.first;
    // Use image.data (Uint8List) instead of reading from path
  },
);
```

### From file_picker

```dart
// OLD: file_picker
FilePickerResult? result = await FilePicker.platform.pickFiles();

// NEW: this package
final result = await MediaPicker.pickFiles(allowedExtensions: ['jpg', 'png']);
result.fold(
  (failure) => print('Error'),
  (files) => print('Got ${files.length} files'),
);
```

## API Reference Summary

### MediaPicker (Static Facade)

- `MediaPicker.pickFromGallery({maxImages, compressionOptions})` - Pick images from gallery
- `MediaPicker.pickVideosFromGallery({maxVideos})` - Pick videos from gallery
- `MediaPicker.pickFiles({allowedExtensions})` - Pick files from file system
- `MediaPicker.captureFromCamera(context, {options, compressionOptions})` - Capture images with camera
- `MediaPicker.captureVideosFromCamera(context, {options, compressionOptions})` - Capture videos with camera
- `MediaPicker.defaultCompressionOptions` - Global compression defaults

### CameraView (Widget)

- `CameraView({options, compressionOptions})` - Full-screen camera UI
- Returns `Map<String, dynamic>` with `images` and `videos` keys

### Entities

- `ImageEntity` - Immutable image with data, path, metadata
- `VideoEntity` - Immutable video with path, duration, metadata
- `ImageMetadataEntity` - Optional image metadata
- `VideoMetadataEntity` - Optional video metadata

### Failures

- `MediaFailure` - Sealed class with 9 failure types
- Use `.when()` for exhaustive pattern matching

### Options

- `CameraViewOptions` - Camera UI configuration
- `CompressionOptions` - Image compression settings
- `CaptureMode` - photo, video, or both